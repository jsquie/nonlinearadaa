// Copyright 2024 James Squires
#pragma once

#define UP_FILTER_TAP_NUM 16 

constexpr int num_up_odd_idx_delay = 7;
constexpr int num_down_odd_idx_delay = 8;
constexpr int M_up = UP_FILTER_TAP_NUM;
constexpr double up_ftaps_evens[16] = {
    -0.0007443025987871019, 0.002868831691615657,   
    -0.00708556372265753,   0.014524410711093269,  
    -0.027092245103165123,  0.04921747378437163,
    -0.09686623966356762,   0.3151550692242564,
    0.3151550692242564,     -0.09686623966356762,
    0.04921747378437163,    -0.027092245103165123,
    0.014524410711093269,   -0.00708556372265753,
    0.002868831691615657,   -0.0007443025987871019,
};

constexpr double up_gain_comp = 0.5000451313536809;


#define DOWN_FILTER_TAP_NUM 359
#define DOWN_FILTER_TAP_NUM_F 359.0f

constexpr int M_down = DOWN_FILTER_TAP_NUM;
constexpr int fM_down = DOWN_FILTER_TAP_NUM_F;

constexpr double down_filter_taps[DOWN_FILTER_TAP_NUM] = {
    -0.00002377715129058551, -0.00018281237756118316, -0.0006881342838998859,
    -0.001607437128060035,   -0.0023939113419796884,  -0.001797837944077672,
    0.001129508420343175,    0.005443768317206072,    0.00813728354092395,
    0.006659560034741982,    0.0020357917554573186,   -0.00146568967061927,
    -0.0008001863652061359,  0.002235586214480097,    0.003215456945392596,
    0.0007935254475977318,   -0.0016602351135532906,  -0.0009305757417369449,
    0.0014959385264301326,   0.001816872285465244,    -0.0003523271712285375,
    -0.0015871926403408041,  -0.00010536302376145956, 0.001539606195018532,
    0.0006979349247761104,   -0.0011403036026176906,  -0.0009451336297451126,
    0.0008338577309542119,   0.0011528604617755856,   -0.0004560185306952527,
    -0.0011950996838672042,  0.000148545971022225,    0.0011860748417208107,
    0.0001388501352881715,   -0.0011038164595680625,  -0.00036585359132158574,
    0.001000005617774411,    0.0005649748781720638,   -0.000859772649376365,
    -0.000716107430898153,   0.0007088295147974782,   0.0008297057249274192,
    -0.000557931763842564,   -0.0009214660279976838,  0.0003989008626445367,
    0.000988393803340692,    -0.00023096292158424344, -0.0010189969670901966,
    0.00007829893296818559,  0.001039717379533003,    0.00007646643809836102,
    -0.0010443476659491144,  -0.00023568945448594104, 0.001023390844163161,
    0.00038567439863643286,  -0.000988741743162369,   -0.0005331276046392852,
    0.0009367291732975488,   0.0006747267265961688,   -0.0008699694563969038,
    -0.0008116062193226508,  0.0007889886904819496,   0.0009485166250179451,
    -0.0006813966007457338,  -0.0010676630921045514,  0.0005625707799946668,
    0.0011769604817521064,   -0.00043086559157039884, -0.0012793873416278392,
    0.0002779860959656232,   0.0013633574022653835,   -0.00011316362381279324,
    -0.001434122941868399,   -0.00006953025260197286, 0.0014832867360745398,
    0.0002651978371194567,   -0.0015073522288227075,  -0.00046547661272883445,
    0.0015143470549284414,   0.0006788023531101269,   -0.001494089282139525,
    -0.0008975846469574552,  0.0014486876940555892,   0.001124723386502391,
    -0.0013676483966540299,  -0.0013468258663590076,  0.0012571896706391641,
    0.0015618895681949426,   -0.001121412362035213,   -0.001775592659576016,
    0.0009489111109387285,   0.001973799621851735,    -0.0007484085316822618,
    -0.002160591424409806,   0.0005115490362888469,   0.0023227063197481233,
    -0.00024619021780436534, -0.002458106670434794,   -0.00004330657264908843,
    0.0025688124036033037,   0.0003626970304199877,   -0.0026418986540794635,
    -0.0006991772046851965,  0.0026852652349593953,   0.0010620054913197297,
    -0.002685143962179686,   -0.0014429414815052446,  0.002636759986986322,
    0.0018335209466934167,   -0.002540864312305065,   -0.0022317660818476173,
    0.0023917290475173993,   0.002627903610919022,    -0.0021935247694191036,
    -0.003024086585039697,   0.0019367253314773875,   0.0034082753316619645,
    -0.001624114655139533,   -0.0037780171522590806,  0.0012494231621523442,
    0.00412024307666797,     -0.0008170266362705188,  -0.004429004309401628,
    0.0003290891766950618,   0.004699666076894663,    0.00021543847157279812,
    -0.0049234937903015336,  -0.0008136627868821855,  0.005095596646476568,
    0.0014687627249424197,   -0.005200742980574733,   -0.0021708929787866427,
    0.005235785875345352,    0.002919974448340162,    -0.00518914070882331,
    -0.0037088305444579763,  0.005053548043893509,    0.004531593573487234,
    -0.004822407959033731,   -0.005384914903934678,   0.004484110014933599,
    0.006258039926385116,    -0.0040374995748437194,  -0.007156364260479969,
    0.003458656049744931,    0.00805963202460786,     -0.002748434510582002,
    -0.008972412371799477,   0.0018814550002439565,   0.009874477634604268,
    -0.0008539390956851068,  -0.010767471413185417,   -0.0003603968659567059,
    0.011636770273896325,    0.0017781700861426086,   -0.012482752245858911,
    -0.0034388434773323295,  0.013292305325368216,    0.005382789385233515,
    -0.014061432670493167,   -0.00767717154843501,    0.014778248836463935,
    0.010410710862303277,    -0.015440427764071927,   -0.01373168411992263,
    0.016040199849351296,    0.017876524798290532,    -0.016572137563654,
    -0.02325829273937513,    0.017031005142823595,    0.03066172411687179,
    -0.01741231293635488,    -0.04177584484133442,    0.017711021371674057,
    0.06099944778279848,     -0.01792894994040298,    -0.10449818001375516,
    0.018058645143144557,    0.3177714259813296,      0.4818941853598482,
    0.3177714259813296,      0.018058645143144557,    -0.10449818001375516,
    -0.01792894994040298,    0.06099944778279848,     0.017711021371674057,
    -0.04177584484133442,    -0.01741231293635488,    0.03066172411687179,
    0.017031005142823595,    -0.02325829273937513,    -0.016572137563654,
    0.017876524798290532,    0.016040199849351296,    -0.01373168411992263,
    -0.015440427764071927,   0.010410710862303277,    0.014778248836463935,
    -0.00767717154843501,    -0.014061432670493167,   0.005382789385233515,
    0.013292305325368216,    -0.0034388434773323295,  -0.012482752245858911,
    0.0017781700861426086,   0.011636770273896325,    -0.0003603968659567059,
    -0.010767471413185417,   -0.0008539390956851068,  0.009874477634604268,
    0.0018814550002439565,   -0.008972412371799477,   -0.002748434510582002,
    0.00805963202460786,     0.003458656049744931,    -0.007156364260479969,
    -0.0040374995748437194,  0.006258039926385116,    0.004484110014933599,
    -0.005384914903934678,   -0.004822407959033731,   0.004531593573487234,
    0.005053548043893509,    -0.0037088305444579763,  -0.00518914070882331,
    0.002919974448340162,    0.005235785875345352,    -0.0021708929787866427,
    -0.005200742980574733,   0.0014687627249424197,   0.005095596646476568,
    -0.0008136627868821855,  -0.0049234937903015336,  0.00021543847157279812,
    0.004699666076894663,    0.0003290891766950618,   -0.004429004309401628,
    -0.0008170266362705188,  0.00412024307666797,     0.0012494231621523442,
    -0.0037780171522590806,  -0.001624114655139533,   0.0034082753316619645,
    0.0019367253314773875,   -0.003024086585039697,   -0.0021935247694191036,
    0.002627903610919022,    0.0023917290475173993,   -0.0022317660818476173,
    -0.002540864312305065,   0.0018335209466934167,   0.002636759986986322,
    -0.0014429414815052446,  -0.002685143962179686,   0.0010620054913197297,
    0.0026852652349593953,   -0.0006991772046851965,  -0.0026418986540794635,
    0.0003626970304199877,   0.0025688124036033037,   -0.00004330657264908843,
    -0.002458106670434794,   -0.00024619021780436534, 0.0023227063197481233,
    0.0005115490362888469,   -0.002160591424409806,   -0.0007484085316822618,
    0.001973799621851735,    0.0009489111109387285,   -0.001775592659576016,
    -0.001121412362035213,   0.0015618895681949426,   0.0012571896706391641,
    -0.0013468258663590076,  -0.0013676483966540299,  0.001124723386502391,
    0.0014486876940555892,   -0.0008975846469574552,  -0.001494089282139525,
    0.0006788023531101269,   0.0015143470549284414,   -0.00046547661272883445,
    -0.0015073522288227075,  0.0002651978371194567,   0.0014832867360745398,
    -0.00006953025260197286, -0.001434122941868399,   -0.00011316362381279324,
    0.0013633574022653835,   0.0002779860959656232,   -0.0012793873416278392,
    -0.00043086559157039884, 0.0011769604817521064,   0.0005625707799946668,
    -0.0010676630921045514,  -0.0006813966007457338,  0.0009485166250179451,
    0.0007889886904819496,   -0.0008116062193226508,  -0.0008699694563969038,
    0.0006747267265961688,   0.0009367291732975488,   -0.0005331276046392852,
    -0.000988741743162369,   0.00038567439863643286,  0.001023390844163161,
    -0.00023568945448594104, -0.0010443476659491144,  0.00007646643809836102,
    0.001039717379533003,    0.00007829893296818559,  -0.0010189969670901966,
    -0.00023096292158424344, 0.000988393803340692,    0.0003989008626445367,
    -0.0009214660279976838,  -0.000557931763842564,   0.0008297057249274192,
    0.0007088295147974782,   -0.000716107430898153,   -0.000859772649376365,
    0.0005649748781720638,   0.001000005617774411,    -0.00036585359132158574,
    -0.0011038164595680625,  0.0001388501352881715,   0.0011860748417208107,
    0.000148545971022225,    -0.0011950996838672042,  -0.0004560185306952527,
    0.0011528604617755856,   0.0008338577309542119,   -0.0009451336297451126,
    -0.0011403036026176906,  0.0006979349247761104,   0.001539606195018532,
    -0.00010536302376145956, -0.0015871926403408041,  -0.0003523271712285375,
    0.001816872285465244,    0.0014959385264301326,   -0.0009305757417369449,
    -0.0016602351135532906,  0.0007935254475977318,   0.003215456945392596,
    0.002235586214480097,    -0.0008001863652061359,  -0.00146568967061927,
    0.0020357917554573186,   0.006659560034741982,    0.00813728354092395,
    0.005443768317206072,    0.001129508420343175,    -0.001797837944077672,
    -0.0023939113419796884,  -0.001607437128060035,   -0.0006881342838998859,
    -0.00018281237756118316, -0.00002377715129058551};

/**
#define DOWN_FILTER_TAP_NUM 209
#define DOWN_FILTER_TAP_NUM_F 209.0f

constexpr int M_down = DOWN_FILTER_TAP_NUM;
constexpr float fM_down = DOWN_FILTER_TAP_NUM_F;


constexpr double down_filter_taps[DOWN_FILTER_TAP_NUM] = {
    -0.0016550762341430308,  -0.0041665939310652385,  -0.003594191447486389,
    0.00251719066089494,     0.009204232105743072,    0.00891685978767867,
    0.0025929990340545586,   -0.0009241688686624757,  0.001780417290846837,
    0.0040583237055417075,   0.0012718880881058892,   -0.0015563530079133385,
    0.0002721535795504213,   0.0025035930967126315,   0.0005429619868192588,
    -0.0017453123023537607,  0.000022984138603901914, 0.0020537985664696805,
    0.00013860481511378278,  -0.0018438080070986866,  0.00013467879098560712,
    0.001974941764859404,    -0.00018853242904265353, -0.0019542465345495637,
    0.0003762055310051086,   0.0020296451360248486,   -0.0005169276482732894,
    -0.0020684792621014857,  0.0006994817682676137,   0.0021265551428543772,
    -0.0008822257189953905,  -0.0021674203444939926,  0.0010935813680486932,
    0.0022115890943483034,   -0.001314750098015205,   -0.0022412051839012007,
    0.0015560490952100908,   0.0022569517475881764,   -0.0018209974880386698,
    -0.002266301757028872,   0.0020937340035129225,   0.0022477597114187653,
    -0.0023927521827856475,  -0.0022146568586112986,  0.0027050436381634005,
    0.002156314932451038,    -0.003031065300689767,   -0.002064650858536239,
    0.0033792643077078716,   0.0019474808728353638,   -0.0037376568321684455,
    -0.0017910129887243696,  0.004112825480457824,    0.0015960522407615228,
    -0.004502958711563328,   -0.0013612537988873558,  0.004903329017739637,
    0.001079361495260796,    -0.005313440162938722,   -0.000745420496662418,
    0.00573623700664673,     0.00036334614253456674,  -0.006156309094600619,
    0.00008808856155454664,  0.006589753951165301,    -0.0005956547623096374,
    -0.007014724209099923,   0.0011845526388683388,   0.007445042007534717,
    -0.0018497468084161031,  -0.007868705069367566,   0.0026066792019242466,
    0.008285357331304153,    -0.0034688911024595,     -0.008698582991922315,
    0.0044411237414403925,   0.009092986565733343,    -0.005557414337636592,
    -0.009483553419766278,   0.006823202063313745,    0.009848519291251277,
    -0.008289679120818303,   -0.010201859443027823,   0.009988471477688032,
    0.01053012360277123,     -0.011992197126080751,   -0.010834696922933549,
    0.014396832948754698,    0.011115959799250405,    -0.017345990204051556,
    -0.01136588090176962,    0.021087101188298568,    0.01158952167903816,
    -0.026030444783605375,   -0.011780011049371056,   0.03296919343261422,
    0.011939078466010828,    -0.04359427254454018,    -0.012063942524891857,
    0.0623135104924757,      0.012154411619644348,    -0.10529117509190798,
    -0.01220839945864449,    0.3180391210647029,      0.5122272478248557,
    0.3180391210647029,      -0.01220839945864449,    -0.10529117509190798,
    0.012154411619644348,    0.0623135104924757,      -0.012063942524891857,
    -0.04359427254454018,    0.011939078466010828,    0.03296919343261422,
    -0.011780011049371056,   -0.026030444783605375,   0.01158952167903816,
    0.021087101188298568,    -0.01136588090176962,    -0.017345990204051556,
    0.011115959799250405,    0.014396832948754698,    -0.010834696922933549,
    -0.011992197126080751,   0.01053012360277123,     0.009988471477688032,
    -0.010201859443027823,   -0.008289679120818303,   0.009848519291251277,
    0.006823202063313745,    -0.009483553419766278,   -0.005557414337636592,
    0.009092986565733343,    0.0044411237414403925,   -0.008698582991922315,
    -0.0034688911024595,     0.008285357331304153,    0.0026066792019242466,
    -0.007868705069367566,   -0.0018497468084161031,  0.007445042007534717,
    0.0011845526388683388,   -0.007014724209099923,   -0.0005956547623096374,
    0.006589753951165301,    0.00008808856155454664,  -0.006156309094600619,
    0.00036334614253456674,  0.00573623700664673,     -0.000745420496662418,
    -0.005313440162938722,   0.001079361495260796,    0.004903329017739637,
    -0.0013612537988873558,  -0.004502958711563328,   0.0015960522407615228,
    0.004112825480457824,    -0.0017910129887243696,  -0.0037376568321684455,
    0.0019474808728353638,   0.0033792643077078716,   -0.002064650858536239,
    -0.003031065300689767,   0.002156314932451038,    0.0027050436381634005,
    -0.0022146568586112986,  -0.0023927521827856475,  0.0022477597114187653,
    0.0020937340035129225,   -0.002266301757028872,   -0.0018209974880386698,
    0.0022569517475881764,   0.0015560490952100908,   -0.0022412051839012007,
    -0.001314750098015205,   0.0022115890943483034,   0.0010935813680486932,
    -0.0021674203444939926,  -0.0008822257189953905,  0.0021265551428543772,
    0.0006994817682676137,   -0.0020684792621014857,  -0.0005169276482732894,
    0.0020296451360248486,   0.0003762055310051086,   -0.0019542465345495637,
    -0.00018853242904265353, 0.001974941764859404,    0.00013467879098560712,
    -0.0018438080070986866,  0.00013860481511378278,  0.0020537985664696805,
    0.000022984138603901914, -0.0017453123023537607,  0.0005429619868192588,
    0.0025035930967126315,   0.0002721535795504213,   -0.0015563530079133385,
    0.0012718880881058892,   0.0040583237055417075,   0.001780417290846837,
    -0.0009241688686624757,  0.0025929990340545586,   0.00891685978767867,
    0.009204232105743072,    0.00251719066089494,     -0.003594191447486389,
    -0.0041665939310652385,  -0.0016550762341430308};
**/
constexpr double square(double a) { return a * a; }

/**
constexpr double up_filter_gain() {
  double temp[UP_FILTER_TAP_NUM] = {};

  for (int i = 0; i < UP_FILTER_TAP_NUM; ++i) {
    temp[i] = square(up_filter_taps[i]);
  }

  double sum = 0.0;
  for (int i = 0; i < UP_FILTER_TAP_NUM; ++i) {
    sum += temp[i];
  }

  return 1 / sum;
}
**/

constexpr double down_filter_gain() {
  double temp[DOWN_FILTER_TAP_NUM] = {};

  for (int i = 0; i < DOWN_FILTER_TAP_NUM; ++i) {
    temp[i] = square(down_filter_taps[i]);
  }

  double sum = 0.0;
  for (int i = 0; i < DOWN_FILTER_TAP_NUM; ++i) {
    sum += temp[i];
  }

  return 1 / sum;
}
